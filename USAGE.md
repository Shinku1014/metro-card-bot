# 地铁卡管理 Telegram Bot 使用指南

## 🚀 快速开始

### 1. 创建 Telegram Bot

1. 在 Telegram 中搜索并打开 [@BotFather](https://t.me/botfather)
2. 发送 `/newbot` 命令
3. 按照提示设置 Bot 名称和用户名
4. 获取 Bot Token（类似：`1234567890:ABCdefGHIjklMNOpqrsTUVwxyz`）

### 2. 配置环境变量

编辑项目根目录的 `.env` 文件：

```bash
# Telegram Bot Token (从 @BotFather 获取)
BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz

# 数据存储路径
DATA_FILE=./data/cards.json
```

将 `your_bot_token_here` 替换为你从 BotFather 获取的实际 Token。

### 3. 启动 Bot

```bash
# 生产环境运行
npm start

# 开发环境运行（自动重启）
npm run dev
```

## 📱 使用方法

### 基本操作流程

1. **启动 Bot**
   - 在 Telegram 中搜索你的 Bot 用户名
   - 点击 "Start" 或发送 `/start` 命令

2. **添加信用卡**
   - **单张添加**：点击 "➕ 添加卡片" 按钮，输入卡片名称
   - **批量添加**：点击 "📋 批量添加" 按钮，输入多张卡片名称（用逗号分隔）
   - 示例：工商银行卡,招商银行卡,建设银行卡

3. **使用地铁**
   - **进站**：点击对应的卡片按钮，状态变为 "🟢 进站中"
   - **出站**：再次点击同一卡片按钮，完成一次乘坐，使用次数 +1

4. **管理卡片**
   - 查看所有卡片的使用情况
   - 删除不需要的卡片

### 界面说明

#### 卡片状态图标
- **⚪ 空闲**：卡片未在使用中，可以进站
- **🟢 进站中**：卡片已刷卡进站，等待出站

#### 使用次数颜色标记
- **🟢 0-4次**：使用次数较少（安全）
- **🟠 5-7次**：使用次数中等（注意）
- **🟡 8-9次**：使用次数较多（警告）
- **🔴 10次**：已达月度上限（限制）

#### 按钮格式
```
🟢 工商银行卡 (3/10) 进站中
└─┘ └──────┘ └─┘ └──┘
 │      │      │    └─ 当前状态
 │      │      └─ 使用次数/月度限制
 │      └─ 卡片名称
 └─ 状态图标
```

### 命令列表

- `/start` - 显示主菜单
- `/cards` - 查看所有卡片
- `/help` - 显示帮助信息

## ⚙️ 功能特性

### 自动月度重置
- 每月1号自动重置所有卡片的使用次数
- 自动清理所有卡片的进站状态

### 使用限制
- 每张卡每月最多使用10次
- 达到限制后无法再次进站
- 实时显示剩余可用次数

### 数据持久化
- 所有数据保存在本地 JSON 文件中
- 支持多用户同时使用
- 自动备份用户数据

## 🔧 故障排除

### 常见问题

**Q: Bot 无响应怎么办？**
A: 检查以下几点：
1. Bot Token 是否正确配置
2. 网络连接是否正常
3. Bot 是否正在运行（检查终端输出）

**Q: 如何删除卡片？**
A: 点击主菜单的 "🗑️ 删除卡片" 按钮，然后选择要删除的卡片。

**Q: 使用次数没有增加？**
A: 确保完成完整的进站→出站流程：
1. 第一次点击：进站（状态变为"进站中"）
2. 第二次点击：出站（使用次数+1，状态变为"空闲"）

**Q: 如何重置月度使用次数？**
A: 系统会在每月1号自动重置，无需手动操作。

**Q: 如何批量添加多张卡片？**
A: 点击 "📋 批量添加" 按钮，然后输入多张卡片名称，用逗号分隔。
示例：工商银行卡,招商银行卡,建设银行卡

**Q: 批量添加有什么限制？**
A: 
- 一次最多添加10张卡片
- 每张卡片名称不能超过20个字符
- 重复的卡片名称会被跳过

### 日志查看

运行时的日志信息会显示在终端中，包括：
- Bot 启动状态
- 用户操作记录
- 错误信息

## 📊 数据管理

### 数据文件位置
- 默认路径：`./data/cards.json`
- 可通过 `.env` 文件中的 `DATA_FILE` 变量修改

### 备份建议
建议定期备份 `data` 目录中的数据文件，防止数据丢失。

```bash
# 备份数据
cp -r data data_backup_$(date +%Y%m%d)
```

## 🔒 安全建议

1. **保护 Bot Token**
   - 不要将 Token 提交到公共代码仓库
   - 定期更换 Bot Token

2. **服务器安全**
   - 确保服务器防火墙配置正确
   - 定期更新系统和依赖包

3. **数据安全**
   - 定期备份用户数据
   - 限制数据文件的访问权限

## 📞 技术支持

如果遇到其他问题，请检查：
1. Node.js 版本是否兼容（推荐 16.x 或更高）
2. 依赖包是否正确安装
3. 环境变量是否正确配置
